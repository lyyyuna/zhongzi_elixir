# Go Bencode Package

A complete implementation of the Bencode encoding format used by BitTorrent protocol.

## Features

- **Complete Bencode Support**: Encode and decode strings, integers, lists, and dictionaries
- **Type Safety**: Strong typing with proper Go type conversion
- **Struct Support**: Encode/decode Go structs with bencode tags
- **Error Handling**: Comprehensive error handling for invalid data
- **Performance**: Efficient encoding and decoding with minimal allocations
- **Standard Compliance**: Follows the BitTorrent bencode specification

## Installation

```go
import "github.com/lyyyuna/zhongzi_go/pkg/bencode"
```

## Quick Start

### Basic Usage

```go
package main

import (
    "fmt"
    "github.com/lyyyuna/zhongzi_go/pkg/bencode"
)

func main() {
    // Encode a string
    data, err := bencode.Encode("hello world")
    if err != nil {
        panic(err)
    }
    fmt.Printf("Encoded: %s\n", data) // Output: 11:hello world

    // Decode back to string
    var result string
    err = bencode.Decode(data, &result)
    if err != nil {
        panic(err)
    }
    fmt.Printf("Decoded: %s\n", result) // Output: hello world
}
```

### Working with Complex Data

```go
// Encode a dictionary
dict := map[string]interface{}{
    "name": "Alice",
    "age":  int64(25),
    "tags": []string{"user", "admin"},
}

encoded, err := bencode.Encode(dict)
if err != nil {
    panic(err)
}

// Decode to interface{}
decoded, err := bencode.DecodeBytes(encoded)
if err != nil {
    panic(err)
}
fmt.Printf("Decoded: %v\n", decoded)
```

### Struct Encoding with Tags

```go
type User struct {
    Name     string   `bencode:"name"`
    Age      int64    `bencode:"age"`
    Email    string   `bencode:"email"`
    Active   bool     `bencode:"active"`
    Ignored  string   `bencode:"-"`        // Will not be encoded
    NoTag    string                        // Uses field name "NoTag"
}

user := User{
    Name:   "John Doe",
    Age:    30,
    Email:  "john@example.com",
    Active: true,
}

// Encode struct
data, err := bencode.Encode(user)
if err != nil {
    panic(err)
}

// Decode back to struct
var decoded User
err = bencode.Decode(data, &decoded)
if err != nil {
    panic(err)
}
```

## API Reference

### Functions

#### `Encode(v interface{}) ([]byte, error)`
Encodes any supported Go value into bencode format.

**Supported Types:**
- `string` → bencode string
- `int`, `int8`, `int16`, `int32`, `int64` → bencode integer
- `uint`, `uint8`, `uint16`, `uint32`, `uint64` → bencode integer
- `[]byte` → bencode string
- `[]T` → bencode list
- `map[string]T` → bencode dictionary
- `struct` → bencode dictionary (with field names or tags as keys)

#### `Decode(data []byte, v interface{}) error`
Decodes bencode data into the provided Go value.

#### `DecodeBytes(data []byte) (interface{}, error)`
Decodes bencode data and returns the raw Go value.

### Encoder/Decoder Types

For more control, you can use the encoder and decoder types directly:

```go
encoder := bencode.NewBencodeEncoder()
decoder := bencode.NewBencodeDecoder()

data, err := encoder.Encode(value)
err = decoder.Decode(data, &result)
```

## Bencode Format

Bencode uses the following encoding rules:

- **Strings**: `<length>:<string>` (e.g., `5:hello`)
- **Integers**: `i<number>e` (e.g., `i42e`, `i-42e`)
- **Lists**: `l<contents>e` (e.g., `l4:spam4:eggse`)
- **Dictionaries**: `d<contents>e` with sorted keys (e.g., `d3:key5:valuee`)

## Examples

See the complete examples in:
- [`examples/bencode_example.go`](../../examples/bencode_example.go) - Comprehensive usage examples
- [`cmd/bencode-test/main.go`](../../cmd/bencode-test/main.go) - Validation tests

## Testing

Run the test suite:

```bash
go test ./pkg/bencode/
```

Run benchmarks:

```bash
go test -bench=. ./pkg/bencode/
```

## Error Handling

The package defines several error types for different failure scenarios:

- `ErrInvalidType` - Unsupported Go type for encoding
- `ErrInvalidFormat` - Invalid bencode format
- `ErrUnexpectedEnd` - Unexpected end of input
- `ErrInvalidString` - Invalid string format
- `ErrInvalidInteger` - Invalid integer format
- `ErrInvalidList` - Invalid list format
- `ErrInvalidDict` - Invalid dictionary format

## Performance

The implementation is optimized for performance:

- Minimal memory allocations during encoding/decoding
- Efficient byte buffer handling
- Fast string and integer parsing
- Benchmark tests included for performance monitoring

## License

This package is part of the zhongzi_go project.