package handler

import (
	"encoding/json"
	"net/http"
	"time"

	"github.com/gorilla/mux"
)

// Response represents a standard API response
type Response struct {
	Message   string      `json:"message"`
	Data      interface{} `json:"data,omitempty"`
	Timestamp time.Time   `json:"timestamp"`
}

// HealthResponse represents health check response
type HealthResponse struct {
	Status  string `json:"status"`
	Version string `json:"version"`
	Uptime  string `json:"uptime"`
}

var startTime = time.Now()

// SetupRoutes configures all application routes
func SetupRoutes(router *mux.Router) {
	// API routes
	api := router.PathPrefix("/api/v1").Subrouter()
	api.HandleFunc("/health", healthCheckHandler).Methods("GET")
	api.HandleFunc("/seed", seedHandler).Methods("GET")
	api.HandleFunc("/ping", pingHandler).Methods("GET")

	// Static routes
	router.HandleFunc("/", homeHandler).Methods("GET")
}

// homeHandler handles the root endpoint
func homeHandler(w http.ResponseWriter, r *http.Request) {
	response := Response{
		Message:   "Welcome to Zhongzi Go - A seed project for Go applications",
		Timestamp: time.Now(),
	}
	
	w.Header().Set("Content-Type", "application/json")
	json.NewEncoder(w).Encode(response)
}

// healthCheckHandler handles health check requests
func healthCheckHandler(w http.ResponseWriter, r *http.Request) {
	uptime := time.Since(startTime)
	
	health := HealthResponse{
		Status:  "healthy",
		Version: "1.0.0",
		Uptime:  uptime.String(),
	}
	
	response := Response{
		Message:   "Service is healthy",
		Data:      health,
		Timestamp: time.Now(),
	}
	
	w.Header().Set("Content-Type", "application/json")
	json.NewEncoder(w).Encode(response)
}

// seedHandler demonstrates the seed functionality
func seedHandler(w http.ResponseWriter, r *http.Request) {
	seedData := map[string]interface{}{
		"name":        "zhongzi_go",
		"description": "A Go seed project template",
		"features": []string{
			"HTTP server with graceful shutdown",
			"Structured logging",
			"Health check endpoint",
			"RESTful API structure",
			"Docker support",
			"Unit tests",
		},
	}
	
	response := Response{
		Message:   "Seed project information",
		Data:      seedData,
		Timestamp: time.Now(),
	}
	
	w.Header().Set("Content-Type", "application/json")
	json.NewEncoder(w).Encode(response)
}

// pingHandler handles ping requests
func pingHandler(w http.ResponseWriter, r *http.Request) {
	response := Response{
		Message:   "pong",
		Timestamp: time.Now(),
	}
	
	w.Header().Set("Content-Type", "application/json")
	json.NewEncoder(w).Encode(response)
}