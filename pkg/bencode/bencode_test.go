package bencode

import (
	"reflect"
	"testing"
)

func TestEncodeString(t *testing.T) {
	tests := []struct {
		input    string
		expected string
	}{
		{"", "0:"},
		{"hello", "5:hello"},
		{"world", "5:world"},
		{"spam", "4:spam"},
	}

	for _, test := range tests {
		result, err := Encode(test.input)
		if err != nil {
			t.Errorf("Error encoding string %q: %v", test.input, err)
		}
		if string(result) != test.expected {
			t.Errorf("Expected %q, got %q", test.expected, string(result))
		}
	}
}

func TestEncodeInteger(t *testing.T) {
	tests := []struct {
		input    int64
		expected string
	}{
		{0, "i0e"},
		{42, "i42e"},
		{-42, "i-42e"},
		{123456789, "i123456789e"},
	}

	for _, test := range tests {
		result, err := Encode(test.input)
		if err != nil {
			t.Errorf("Error encoding integer %d: %v", test.input, err)
		}
		if string(result) != test.expected {
			t.Errorf("Expected %q, got %q", test.expected, string(result))
		}
	}
}

func TestEncodeList(t *testing.T) {
	tests := []struct {
		input    interface{}
		expected string
	}{
		{[]interface{}{}, "le"},
		{[]string{"spam", "eggs"}, "l4:spam4:eggse"},
		{[]int{1, 2, 3}, "li1ei2ei3ee"},
		{[]interface{}{"hello", 42}, "l5:helloi42ee"},
	}

	for _, test := range tests {
		result, err := Encode(test.input)
		if err != nil {
			t.Errorf("Error encoding list %v: %v", test.input, err)
		}
		if string(result) != test.expected {
			t.Errorf("Expected %q, got %q", test.expected, string(result))
		}
	}
}

func TestEncodeDict(t *testing.T) {
	tests := []struct {
		input    map[string]interface{}
		expected string
	}{
		{map[string]interface{}{}, "de"},
		{map[string]interface{}{"spam": "eggs"}, "d4:spam4:eggse"},
		{map[string]interface{}{"num": 42}, "d3:numi42ee"},
		{map[string]interface{}{"b": "y", "a": "x"}, "d1:a1:x1:b1:ye"}, // sorted keys
	}

	for _, test := range tests {
		result, err := Encode(test.input)
		if err != nil {
			t.Errorf("Error encoding dict %v: %v", test.input, err)
		}
		if string(result) != test.expected {
			t.Errorf("Expected %q, got %q", test.expected, string(result))
		}
	}
}

func TestEncodeBytes(t *testing.T) {
	input := []byte("hello")
	expected := "5:hello"

	result, err := Encode(input)
	if err != nil {
		t.Errorf("Error encoding bytes %v: %v", input, err)
	}
	if string(result) != expected {
		t.Errorf("Expected %q, got %q", expected, string(result))
	}
}

func TestEncodeStruct(t *testing.T) {
	type TestStruct struct {
		Name  string `bencode:"name"`
		Age   int    `bencode:"age"`
		Email string
	}

	input := TestStruct{
		Name:  "John",
		Age:   30,
		Email: "john@example.com",
	}

	result, err := Encode(input)
	if err != nil {
		t.Errorf("Error encoding struct %v: %v", input, err)
	}

	// Decode it back to verify
	var decoded TestStruct
	err = Decode(result, &decoded)
	if err != nil {
		t.Errorf("Error decoding struct: %v", err)
	}

	if decoded.Name != input.Name || decoded.Age != input.Age || decoded.Email != input.Email {
		t.Errorf("Struct roundtrip failed. Expected %v, got %v", input, decoded)
	}
}

func TestDecodeString(t *testing.T) {
	tests := []struct {
		input    string
		expected string
	}{
		{"0:", ""},
		{"5:hello", "hello"},
		{"4:spam", "spam"},
	}

	for _, test := range tests {
		var result string
		err := Decode([]byte(test.input), &result)
		if err != nil {
			t.Errorf("Error decoding string %q: %v", test.input, err)
		}
		if result != test.expected {
			t.Errorf("Expected %q, got %q", test.expected, result)
		}
	}
}

func TestDecodeInteger(t *testing.T) {
	tests := []struct {
		input    string
		expected int64
	}{
		{"i0e", 0},
		{"i42e", 42},
		{"i-42e", -42},
		{"i123456789e", 123456789},
	}

	for _, test := range tests {
		var result int64
		err := Decode([]byte(test.input), &result)
		if err != nil {
			t.Errorf("Error decoding integer %q: %v", test.input, err)
		}
		if result != test.expected {
			t.Errorf("Expected %d, got %d", test.expected, result)
		}
	}
}

func TestDecodeList(t *testing.T) {
	tests := []struct {
		input    string
		expected []interface{}
	}{
		{"le", []interface{}{}},
		{"l4:spam4:eggse", []interface{}{"spam", "eggs"}},
		{"li1ei2ei3ee", []interface{}{int64(1), int64(2), int64(3)}},
	}

	for _, test := range tests {
		result, err := DecodeBytes([]byte(test.input))
		if err != nil {
			t.Errorf("Error decoding list %q: %v", test.input, err)
		}
		if !reflect.DeepEqual(result, test.expected) {
			t.Errorf("Expected %v, got %v", test.expected, result)
		}
	}
}

func TestDecodeDict(t *testing.T) {
	tests := []struct {
		input    string
		expected map[string]interface{}
	}{
		{"de", map[string]interface{}{}},
		{"d4:spam4:eggse", map[string]interface{}{"spam": "eggs"}},
		{"d3:numi42ee", map[string]interface{}{"num": int64(42)}},
	}

	for _, test := range tests {
		result, err := DecodeBytes([]byte(test.input))
		if err != nil {
			t.Errorf("Error decoding dict %q: %v", test.input, err)
		}
		if !reflect.DeepEqual(result, test.expected) {
			t.Errorf("Expected %v, got %v", test.expected, result)
		}
	}
}

func TestDecodeBytes(t *testing.T) {
	input := "5:hello"
	var result []byte
	err := Decode([]byte(input), &result)
	if err != nil {
		t.Errorf("Error decoding bytes %q: %v", input, err)
	}
	if string(result) != "hello" {
		t.Errorf("Expected %q, got %q", "hello", string(result))
	}
}

func TestRoundTrip(t *testing.T) {
	tests := []interface{}{
		"hello world",
		int64(42),
		[]string{"spam", "eggs"},
		map[string]interface{}{"key": "value", "number": int64(123)},
		[]interface{}{"mixed", int64(42), map[string]interface{}{"nested": "dict"}},
	}

	for _, test := range tests {
		encoded, err := Encode(test)
		if err != nil {
			t.Errorf("Error encoding %v: %v", test, err)
			continue
		}

		decoded, err := DecodeBytes(encoded)
		if err != nil {
			t.Errorf("Error decoding %v: %v", test, err)
			continue
		}

		if !reflect.DeepEqual(test, decoded) {
			t.Errorf("Roundtrip failed for %v. Got %v", test, decoded)
		}
	}
}

func TestInvalidData(t *testing.T) {
	invalidInputs := []string{
		"invalid",
		"i42",     // missing 'e'
		"10:short", // string too short
		"l42",     // list missing 'e'
		"d42",     // dict missing 'e'
		"-1:test", // negative string length
	}

	for _, input := range invalidInputs {
		_, err := DecodeBytes([]byte(input))
		if err == nil {
			t.Errorf("Expected error for invalid input %q, but got none", input)
		}
	}
}

func BenchmarkEncodeString(b *testing.B) {
	input := "hello world this is a test string"
	for i := 0; i < b.N; i++ {
		_, err := Encode(input)
		if err != nil {
			b.Fatal(err)
		}
	}
}

func BenchmarkDecodeString(b *testing.B) {
	input := []byte("33:hello world this is a test string")
	for i := 0; i < b.N; i++ {
		var result string
		err := Decode(input, &result)
		if err != nil {
			b.Fatal(err)
		}
	}
}

func BenchmarkEncodeDict(b *testing.B) {
	input := map[string]interface{}{
		"name":    "John Doe",
		"age":     int64(30),
		"active":  true,
		"numbers": []int{1, 2, 3, 4, 5},
	}
	
	for i := 0; i < b.N; i++ {
		_, err := Encode(input)
		if err != nil {
			b.Fatal(err)
		}
	}
}