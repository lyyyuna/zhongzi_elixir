package main

import (
	"fmt"
	"log"

	"github.com/lyyyuna/zhongzi_go/pkg/bencode"
)

func main() {
	fmt.Println("Bencode Implementation Validation")
	fmt.Println("=================================")

	// Test 1: String encoding/decoding
	testString()

	// Test 2: Integer encoding/decoding
	testInteger()

	// Test 3: List encoding/decoding
	testList()

	// Test 4: Dictionary encoding/decoding
	testDict()

	// Test 5: Complex structure
	testComplex()

	fmt.Println("\n✅ All tests passed! Bencode implementation is working correctly.")
}

func testString() {
	fmt.Println("\n1. String Test:")
	original := "Hello, 世界!"
	
	encoded, err := bencode.Encode(original)
	if err != nil {
		log.Fatalf("Encode error: %v", err)
	}
	fmt.Printf("   Original: %q\n", original)
	fmt.Printf("   Encoded:  %q\n", string(encoded))
	
	var decoded string
	err = bencode.Decode(encoded, &decoded)
	if err != nil {
		log.Fatalf("Decode error: %v", err)
	}
	fmt.Printf("   Decoded:  %q\n", decoded)
	
	if original != decoded {
		log.Fatalf("String test failed: %q != %q", original, decoded)
	}
	fmt.Println("   ✅ String test passed")
}

func testInteger() {
	fmt.Println("\n2. Integer Test:")
	original := int64(-42)
	
	encoded, err := bencode.Encode(original)
	if err != nil {
		log.Fatalf("Encode error: %v", err)
	}
	fmt.Printf("   Original: %d\n", original)
	fmt.Printf("   Encoded:  %q\n", string(encoded))
	
	var decoded int64
	err = bencode.Decode(encoded, &decoded)
	if err != nil {
		log.Fatalf("Decode error: %v", err)
	}
	fmt.Printf("   Decoded:  %d\n", decoded)
	
	if original != decoded {
		log.Fatalf("Integer test failed: %d != %d", original, decoded)
	}
	fmt.Println("   ✅ Integer test passed")
}

func testList() {
	fmt.Println("\n3. List Test:")
	original := []interface{}{"spam", int64(42), "eggs"}
	
	encoded, err := bencode.Encode(original)
	if err != nil {
		log.Fatalf("Encode error: %v", err)
	}
	fmt.Printf("   Original: %v\n", original)
	fmt.Printf("   Encoded:  %q\n", string(encoded))
	
	decoded, err := bencode.DecodeBytes(encoded)
	if err != nil {
		log.Fatalf("Decode error: %v", err)
	}
	fmt.Printf("   Decoded:  %v\n", decoded)
	
	// Verify list contents
	decodedList, ok := decoded.([]interface{})
	if !ok {
		log.Fatalf("Expected list, got %T", decoded)
	}
	if len(decodedList) != 3 {
		log.Fatalf("Expected 3 items, got %d", len(decodedList))
	}
	if decodedList[0].(string) != "spam" || decodedList[1].(int64) != 42 || decodedList[2].(string) != "eggs" {
		log.Fatalf("List contents don't match")
	}
	fmt.Println("   ✅ List test passed")
}

func testDict() {
	fmt.Println("\n4. Dictionary Test:")
	original := map[string]interface{}{
		"name": "Alice",
		"age":  int64(25),
		"city": "Tokyo",
	}
	
	encoded, err := bencode.Encode(original)
	if err != nil {
		log.Fatalf("Encode error: %v", err)
	}
	fmt.Printf("   Original: %v\n", original)
	fmt.Printf("   Encoded:  %q\n", string(encoded))
	
	decoded, err := bencode.DecodeBytes(encoded)
	if err != nil {
		log.Fatalf("Decode error: %v", err)
	}
	fmt.Printf("   Decoded:  %v\n", decoded)
	
	// Verify dictionary contents
	decodedDict, ok := decoded.(map[string]interface{})
	if !ok {
		log.Fatalf("Expected dict, got %T", decoded)
	}
	if decodedDict["name"].(string) != "Alice" || 
	   decodedDict["age"].(int64) != 25 || 
	   decodedDict["city"].(string) != "Tokyo" {
		log.Fatalf("Dict contents don't match")
	}
	fmt.Println("   ✅ Dictionary test passed")
}

func testComplex() {
	fmt.Println("\n5. Complex Structure Test:")
	
	type Person struct {
		Name    string   `bencode:"name"`
		Age     int64    `bencode:"age"`
		Hobbies []string `bencode:"hobbies"`
	}
	
	original := Person{
		Name:    "Bob",
		Age:     30,
		Hobbies: []string{"reading", "coding", "music"},
	}
	
	encoded, err := bencode.Encode(original)
	if err != nil {
		log.Fatalf("Encode error: %v", err)
	}
	fmt.Printf("   Original: %+v\n", original)
	fmt.Printf("   Encoded:  %q\n", string(encoded))
	
	var decoded Person
	err = bencode.Decode(encoded, &decoded)
	if err != nil {
		log.Fatalf("Decode error: %v", err)
	}
	fmt.Printf("   Decoded:  %+v\n", decoded)
	
	if original.Name != decoded.Name || 
	   original.Age != decoded.Age || 
	   len(original.Hobbies) != len(decoded.Hobbies) {
		log.Fatalf("Struct test failed")
	}
	for i, hobby := range original.Hobbies {
		if hobby != decoded.Hobbies[i] {
			log.Fatalf("Hobby mismatch: %q != %q", hobby, decoded.Hobbies[i])
		}
	}
	fmt.Println("   ✅ Complex structure test passed")
}